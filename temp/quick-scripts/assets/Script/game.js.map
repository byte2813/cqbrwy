{"version":3,"sources":["game.js"],"names":["AC","require","cc","Class","extends","Component","properties","_status","blockPrefab","Prefab","blockSprite","SpriteFrame","warningSpriteFrame","propSpriteFrame","checkMgr","revivePage","Node","tutorialNode","shareBtn","shareSuccessDialog","start","bindNode","generatePool","loadRes","init","c","_controller","_score","scoreMgr","rowNum","config","json","gap","animationSpeed","blockWidth","reviveTimer","active","isWeChat","social","node","blocksContainer","getChildByName","gameStart","recoveryAllBlocks","then","sys","platform","WECHAT_GAME","hasShared","data","isFirstTime","mapSet","result","showTutorial","map","tutorialProgress","target","label","runAction","repeatForever","sequence","scaleTo","x","y","getComponent","Label","string","closeTutorial","stopAllActions","onTouched","type","setTimeout","isFirst","wx","getStorageSync","setStorageSync","localStorage","getItem","setItem","onItemShare","onItemShareButton","fakeShareSuccess","onItemAdv","onReviveButton","onCreateBomb","Math","floor","random","_itemType","changeItemType","num","Array","self","a","b","d","tutorialPos","Promise","resolve","reject","i","j","itemType","instantiateBlock","color","width","startTime","startAnimationTime","check","checkNeedFall","checkNeedFallTimer","clearTimeout","onFall","checkGenerateProp","chain","canFall","blockPool","put","playFallAction","k","gameOver","pageMgr","addPage","closeBannerAdv","askRevive","rangeSprite","Sprite","fillRange","isRangeAction","numLabel","clearInterval","setInterval","onSkipRevive","showReviveSuccess","onReviveCertainBtn","removePage","onRevive","update","pages","onGameOver","restart","onOpenPage","onUserTouched","iid","jid","warning","pos","generatePropItem","onItem","tipBox","addMult","musicMgr","onDouble","distance","sqrt","pow","surfaceAction","shackAction","onShakePhone","isPropChain","onBoom","rockAction","onStep","onMagic","isSingle","NodePool","block","instantiate","parent","size","get","scale","children","length"],"mappings":"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","file":"game.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["/**\n * @author uu\n * @file 游戏控制\n */\nvar AC = require('action')\ncc.Class({\n\textends: cc.Component,\n\tproperties: {\n\t\t_status: 0, //0 未开始 1 游戏开始 2 游戏暂停 3 游戏结束 4 下落状态 5无法触摸状态\n\t\tblockPrefab: cc.Prefab,\n\t\tblockSprite: [cc.SpriteFrame], //todo: 换成动态生成 暂不处理\n\t\twarningSpriteFrame: [cc.SpriteFrame],\n\t\tpropSpriteFrame: [cc.SpriteFrame],\n\t\tcheckMgr: require(\"check\"),\n\t\trevivePage: cc.Node,\n\t\ttutorialNode: cc.Node,\n\t\tshareBtn: cc.Node,\n\t\tshareSuccessDialog: cc.Node,\n\t},\n\tstart() {\n\t\tthis.bindNode()\n\t\tthis.generatePool()\n\t\tthis.loadRes()\n\t},\n\tloadRes() {\n\n\t},\n\tinit(c) {\n\t\tthis._controller = c\n\t\tthis._score = c.scoreMgr\n\t\tthis.rowNum = c.config.json.rowNum\n\t\tthis.gap = c.config.json.gap\n\t\tthis.animationSpeed = c.config.json.gap\n\t\tthis.blockWidth = (730 - (this.rowNum + 1) * this.gap) / this.rowNum\n\t\tthis.reviveTimer = null\n\t\tthis.tutorialNode.active = false\n\t\tthis.isWeChat = this._controller.social.node.active\n\t\tthis.shareSuccessDialog.active = false\n\t\t//console.log(this.gap)\n\t\t//console.log(this.blockWidth)\n\t},\n\t// 动态获取需要动态控制的组件\n\tbindNode() {\n\t\tthis.blocksContainer = this.node.getChildByName('map')\n\t},\n\t//---------------- 游戏控制 ---------------------\n\t// 游戏开始\n\tgameStart() {\n\t\tthis.recoveryAllBlocks().then()\n\t\tthis.shareBtn.active = true\n\t\tif (cc.sys.platform === cc.sys.WECHAT_GAME) {\n\t\t\tthis._controller.social.hasShared = false\n\t\t}\n\t\tthis._score.init(this)\n\t\tlet data = [\n\t\t\t[1, 1, 1, 1, 1, 1, 1, 1],\n\t\t\t[1, 1, 1, 1, 1, 1, 1, 1],\n\t\t\t[4, 2, 3, 4, 2, 2, 3, 4]\n\t\t]\n\t\tif (this.isFirstTime()) {\n\t\t\tthis.mapSet(this.rowNum, data).then((result) => {\n\t\t\t\tthis.showTutorial(this.map[1][4], '点击连续的区域生成炸弹鸭')\n\t\t\t\tthis.tutorialProgress = 1\n\t\t\t\tthis._status = 1\n\t\t\t})\n\t\t} else {\n\t\t\tthis.mapSet(this.rowNum).then((result) => {\n\t\t\t\tthis._status = 1\n\t\t\t})\n\t\t}\n\t},\n\tshowTutorial(target, label) {\n\t\tthis.tutorialNode.active = true\n\t\tthis.tutorialNode.getChildByName('targetBtn').getChildByName('sqr').runAction(cc.repeatForever(cc.sequence(cc.scaleTo(0.3, 0.8), cc.scaleTo(0.3, 1.2))))\n\t\tthis.tutorialNode.getChildByName('target').x = target.x\n\t\tthis.tutorialNode.getChildByName('target').y = target.y\n\t\tthis.tutorialNode.getChildByName('targetBtn').x = target.x\n\t\tthis.tutorialNode.getChildByName('targetBtn').y = target.y\n\t\tthis.tutorialNode.getChildByName('label').getChildByName('label').getComponent(cc.Label).string = label\n\t},\n\tcloseTutorial() {\n\t\tthis.tutorialNode.getChildByName('targetBtn').getChildByName('sqr').stopAllActions()\n\t\t// console.log('close Tutorial ')\n\t\tthis.tutorialNode.active = false\n\t\tthis._status = 1\n\n\t\tthis.map[1][4].getComponent('cell').onTouched({\n\t\t\ttype: 1\n\t\t}, false, false)\n\t\tif (this.tutorialProgress == 1) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.showTutorial(this.map[1][4], '点击炸弹消除所有同色方块哦')\n\t\t\t\tthis.tutorialProgress = 2\n\t\t\t}, 1000)\n\t\t}\n\t},\n\tisFirstTime() {\n\t\tlet isFirst = false\n\t\tif (cc.sys.platform === cc.sys.WECHAT_GAME && !wx.getStorageSync('isFirst')) {\n\t\t\twx.setStorageSync('isFirst', \"1\")\n\t\t\tisFirst = true\n\t\t} else if (!cc.sys.localStorage.getItem('isFirst')) {\n\t\t\tcc.sys.localStorage.setItem('isFirst', \"1\")\n\t\t\tisFirst = true\n\t\t}\n\t\treturn isFirst\n\t},\n\tonItemShare() {\n\t\tif (cc.sys.platform === cc.sys.WECHAT_GAME) {\n\t\t\tthis._controller.social.onItemShareButton()\n\t\t} else {\n\t\t\tthis.fakeShareSuccess()\n\t\t}\n\t},\n\tonItemAdv() {\n\t\tif (cc.sys.platform === cc.sys.WECHAT_GAME) {\n\t\t\tthis._controller.social.onReviveButton(2)\n\t\t} else {\n\t\t\tthis.fakeShareSuccess()\n\t\t}\n\t},\n\tfakeShareSuccess() {\n\t\tthis.shareBtn.active = false\n\t\tthis.shareSuccessDialog.active = true\n\t},\n\tonCreateBomb() {\n\t\tlet x = Math.floor(Math.random() * 8)\n\t\tlet y = Math.floor(Math.random() * 8)\n\t\tthis.shareSuccessDialog.active = false\n\t\tif(this.map[x][y].getComponent('cell')._itemType==0){\n\t\t\tthis.map[x][y].getComponent('cell').changeItemType(2)\n\t\t}else{\n\t\t\tthis.onCreateBomb()\n\t\t\treturn\n\t\t}\n\t},\n\t/**\n\t * 初始化地图\n\t * @param {*} num \n\t * @param {*} data 传入颜色数组\n\t */\n\tmapSet(num, data) {\n\t\tthis.map = new Array()\n\t\tlet self = this\n\t\t// 生成两个随机的对象数组\n\t\tlet a = Math.floor(Math.random() * num)\n\t\tlet b = Math.floor(Math.random() * num)\n\n\t\tlet c = Math.floor(1 + Math.random() * (num - 1)) - 1\n\t\ta == c ? c++ : ''\n\t\tlet d = Math.floor(Math.random() * num)\n\t\tthis.tutorialPos = [c, d]\n\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tfor (let i = 0; i < num; i++) { //行\n\t\t\t\tthis.map[i] = new Array()\n\t\t\t\tfor (let j = 0; j < num; j++) { //列\n\t\t\t\t\tlet itemType = (i == a && j == b) ? 1 : (i == c && j == d) ? (data ? 1 : 2) : 0\n\t\t\t\t\tself.map[i][j] = self.instantiateBlock(self, {\n\t\t\t\t\t\tx: j,\n\t\t\t\t\t\ty: i,\n\t\t\t\t\t\tcolor: (data && data[i]) ? data[i][j] : null,\n\t\t\t\t\t\twidth: self.blockWidth,\n\t\t\t\t\t\tstartTime: (i + j + 1) * self._controller.config.json.startAnimationTime / num * 2\n\t\t\t\t\t}, self.blocksContainer, itemType)\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.checkMgr.init(this)\n\t\t\tsetTimeout(() => {\n\t\t\t\t\tresolve('200 OK');\n\t\t\t\t\tthis.checkMgr.check(this)\n\t\t\t\t}, self._controller.config.json.startAnimationTime * num / 2 / 1\n\t\t\t\t//  (cc.game.getFrameRate() / 60)\n\t\t\t)\n\t\t})\n\t},\n\t//防抖动 判断是否需要检测下落\n\tcheckNeedFall() {\n\t\tif (this.checkNeedFallTimer) {\n\t\t\tclearTimeout(this.checkNeedFallTimer)\n\t\t}\n\t\tthis.checkNeedFallTimer = setTimeout(() => {\n\t\t\t\tif (this._status == 5) {\n\t\t\t\t\tthis._status = 4\n\t\t\t\t\tthis.onFall()\n\t\t\t\t}\n\t\t\t}, 300 / 1\n\t\t\t// (cc.game.getFrameRate() / 60)\n\t\t)\n\t},\n\t//方块下落\n\tonFall() {\n\t\tthis.checkGenerateProp(this._score.chain).then(() => {\n\t\t\tlet self = this\n\t\t\tlet canFall = 0\n\t\t\t//从每一列的最下面一个开始往上判断\n\t\t\t//如果有空 就判断有几个空 然后让最上方的方块掉落下来\n\t\t\tfor (let j = this.rowNum - 1; j >= 0; j--) {\n\t\t\t\tcanFall = 0\n\t\t\t\tfor (let i = this.rowNum - 1; i >= 0; i--) {\n\t\t\t\t\tif (this.map[i][j].getComponent('cell')._status == 2) {\n\t\t\t\t\t\tthis.blockPool.put(this.map[i][j])\n\t\t\t\t\t\tthis.map[i][j] = null\n\t\t\t\t\t\tcanFall++\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (canFall != 0) {\n\t\t\t\t\t\t\tthis.map[i + canFall][j] = this.map[i][j]\n\t\t\t\t\t\t\tthis.map[i][j] = null\n\t\t\t\t\t\t\tthis.map[i + canFall][j].getComponent('cell').playFallAction(canFall, {\n\t\t\t\t\t\t\t\tx: j,\n\t\t\t\t\t\t\t\ty: i + canFall,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (var k = 0; k < canFall; k++) {\n\t\t\t\t\tthis.map[k][j] = this.instantiateBlock(this, {\n\t\t\t\t\t\tx: j,\n\t\t\t\t\t\ty: k,\n\t\t\t\t\t\twidth: this.blockWidth,\n\t\t\t\t\t\tstartTime: null\n\t\t\t\t\t}, this.blocksContainer, '', {\n\t\t\t\t\t\tx: j,\n\t\t\t\t\t\ty: -canFall + k\n\t\t\t\t\t})\n\t\t\t\t\tthis.map[k][j].getComponent('cell').playFallAction(canFall, null)\n\t\t\t\t}\n\t\t\t}\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.checkMgr.init(this)\n\t\t\t\tthis.checkMgr.check(this)\n\t\t\t\tthis._status = 1\n\t\t\t}, 250)\n\t\t})\n\t},\n\tgameOver() {\n\t\tthis._status = 3\n\t\tthis._controller.pageMgr.addPage(2)\n\t\tthis._controller.pageMgr.addPage(4)\n\t\tif (this._controller.social.node.active) {\n\t\t\tthis._controller.social.closeBannerAdv()\n\t\t}\n\t},\n\t// todo 复活\n\taskRevive() {\n\t\tthis._controller.pageMgr.addPage(2)\n\t\tthis._controller.pageMgr.addPage(5)\n\t\tthis.revivePage.active = true\n\t\tthis.revivePage.getChildByName('askRevive').active = true\n\t\tthis.revivePage.getChildByName('successRevive').active = false\n\t\tthis.rangeSprite = this.revivePage.getChildByName('askRevive').getChildByName('numBg').getChildByName('sprite').getComponent(cc.Sprite)\n\t\tthis.rangeSprite.fillRange = 1\n\t\tthis.isRangeAction = true\n\t\tlet numLabel = this.revivePage.getChildByName('askRevive').getChildByName('numBg').getChildByName('num').getComponent(cc.Label)\n\t\tnumLabel.string = 9\n\t\tif (this.reviveTimer) {\n\t\t\tclearInterval(this.reviveTimer)\n\t\t}\n\t\tthis.reviveTimer = setInterval(() => {\n\t\t\tif (+numLabel.string > 0) {\n\t\t\t\tnumLabel.string--\n\t\t\t\tthis.rangeSprite.fillRange = 1\n\t\t\t} else {\n\t\t\t\tthis.onSkipRevive()\n\t\t\t}\n\t\t}, 1000)\n\n\t},\n\tonReviveButton() {\n\t\tclearInterval(this.reviveTimer)\n\t\tthis.isRangeAction = false\n\t\tif (cc.sys.platform === cc.sys.WECHAT_GAME) {\n\t\t\tthis._controller.social.onReviveButton(1)\n\t\t} else {\n\t\t\tthis.showReviveSuccess()\n\t\t}\n\t},\n\tshowReviveSuccess() {\n\t\t//console.log('打开复活成功页面')\n\t\tthis.revivePage.getChildByName('askRevive').active = false\n\t\tthis.revivePage.getChildByName('successRevive').active = true\n\t},\n\tonReviveCertainBtn() {\n\t\tthis._controller.pageMgr.removePage(2)\n\t\tthis.revivePage.active = false\n\t\tthis._status = 1\n\t\tthis._score.onRevive()\n\t},\n\tupdate() {\n\t\tif (this.isRangeAction) {\n\t\t\tthis.rangeSprite.fillRange -= 1 / 60\n\t\t}\n\t},\n\tonSkipRevive() {\n\t\tclearInterval(this.reviveTimer)\n\t\tthis._controller.pageMgr.pages[5].active = false\n\t\tthis._score.onGameOver(true)\n\t\tthis.isRangeAction = false\n\t},\n\trestart() {\n\t\tthis._controller.pageMgr.onOpenPage(1)\n\t\tthis.recoveryAllBlocks().then(() => {\n\t\t\tthis.gameStart()\n\t\t})\n\t},\n\t// -----------------道具相关---------------\n\t// 储存用户点击时的方块 用于生成道具\n\tonUserTouched(iid, jid, itemType, color, warning, pos) {\n\t\tthis.target = {\n\t\t\ti: iid,\n\t\t\tj: jid,\n\t\t\tcolor: color,\n\t\t\titemType: itemType,\n\t\t\tx: pos.x,\n\t\t\ty: pos.y,\n\t\t\twarning: warning\n\t\t}\n\t},\n\t// 生成道具 type 1为双倍倍数 2为炸弹 3为加五百\n\tgeneratePropItem(type) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\t// 是否做道具生成动画\n\t\t\tthis.map[this.target.i][this.target.j] = this.instantiateBlock(this, {\n\t\t\t\tx: this.target.j,\n\t\t\t\ty: this.target.i,\n\t\t\t\tcolor: this.target.color,\n\t\t\t\twidth: this.blockWidth,\n\t\t\t\tstartTime: null\n\t\t\t}, this.blocksContainer, type)\n\t\t\tsetTimeout(() => {\n\t\t\t\tresolve()\n\t\t\t}, 300)\n\t\t})\n\t},\n\tcheckGenerateProp(chain) {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tif (this.target && this.target.warning) {\n\t\t\t\tthis.generatePropItem(this.target.warning).then(() => {\n\t\t\t\t\tresolve()\n\t\t\t\t\treturn\n\t\t\t\t})\n\t\t\t}\n\t\t\tresolve()\n\t\t})\n\t},\n\tonItem(type, color, pos) {\n\t\tswitch (type) {\n\t\t\tcase 1:\n\t\t\t\t// 分数翻倍 最高八倍\n\t\t\t\tthis._score.tipBox.init(this._score, 1)\n\t\t\t\tthis._score.addMult(color, pos)\n\t\t\t\tthis._controller.musicMgr.onDouble()\n\t\t\t\tfor (let i = 0; i < this.rowNum; i++) { //行\n\t\t\t\t\tfor (let j = 0; j < this.rowNum; j++) { //列\n\t\t\t\t\t\tif (this.map[i][j] && this.map[i][j].getComponent('cell')._status == 1) {\n\t\t\t\t\t\t\tlet distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\n\t\t\t\t\t\t\tif (distance != 0) {\n\t\t\t\t\t\t\t\tthis.map[i][j].getComponent('cell').surfaceAction(distance)\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 2:\n\t\t\t\t// 炸弹 消除同种颜色的\n\t\t\t\tthis._score.tipBox.init(this._score, 2)\n\t\t\t\tthis.node.runAction(AC.shackAction(0.1, 10))\n\t\t\t\tif (this._controller.social.node.active) {\n\t\t\t\t\tthis._controller.social.onShakePhone()\n\t\t\t\t}\n\t\t\t\tthis.isPropChain = true\n\t\t\t\tthis._controller.musicMgr.onBoom()\n\t\t\t\tfor (let i = 0; i < this.rowNum; i++) { //行\n\t\t\t\t\tfor (let j = 0; j < this.rowNum; j++) { //列\n\t\t\t\t\t\tif (this.map[i][j] && this.map[i][j].getComponent('cell').color == color && this.map[i][j] && this.map[i][j].getComponent('cell')._status != 2) {\n\t\t\t\t\t\t\tthis.map[i][j].getComponent('cell').onTouched(color, false, true)\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.map[i][j].runAction(AC.rockAction(0.2, 10))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\tcase 3: //:  加步数\n\t\t\t\tthis._score.tipBox.init(this._score, 4)\n\t\t\t\tthis._controller.musicMgr.onDouble()\n\t\t\t\tfor (let i = 0; i < this.rowNum; i++) { //行\n\t\t\t\t\tfor (let j = 0; j < this.rowNum; j++) { //列\n\t\t\t\t\t\tif (this.map[i][j] && this.map[i][j].getComponent('cell')._status == 1) {\n\t\t\t\t\t\t\tlet distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\n\t\t\t\t\t\t\tif (distance != 0) {\n\t\t\t\t\t\t\t\tthis.map[i][j].getComponent('cell').surfaceAction(distance)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis._score.onStep(3).then()\n\t\t\t\tbreak;\n\t\t\tcase 4: // : 消除全部单身的方块\n\t\t\t\tthis._score.tipBox.init(this._score, 5)\n\t\t\t\tthis.isPropChain = true\n\t\t\t\tthis._controller.musicMgr.onMagic()\n\t\t\t\tfor (let i = 0; i < this.rowNum; i++) { //行\n\t\t\t\t\tfor (let j = 0; j < this.rowNum; j++) { //列\n\t\t\t\t\t\tif (this.map[i][j] && this.map[i][j].getComponent('cell').isSingle && this.map[i][j] && this.map[i][j].getComponent('cell')._status != 2) {\n\t\t\t\t\t\t\tlet distance = Math.sqrt(Math.pow(pos.x - this.map[i][j].x, 2) + Math.pow(pos.y - this.map[i][j].y, 2))\n\t\t\t\t\t\t\tthis.map[i][j].getComponent('cell').onTouched(color, false, true, distance)\n\t\t\t\t\t\t\t// console.log(\"魔法棒触发的点\", i, j, this.map[i][j].getComponent('cell').color, this.map[i][j].getComponent('cell').isSingle)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t},\n\t//--------------------- 预制体实例化---------------------\n\t// 生成对象池\n\tgeneratePool() {\n\t\tthis.blockPool = new cc.NodePool()\n\t\tfor (let i = 0; i < Math.pow(this.rowNum, 2); i++) {\n\t\t\tlet block = cc.instantiate(this.blockPrefab)\n\t\t\tthis.blockPool.put(block)\n\t\t}\n\t},\n\t// 实例化单个方块\n\tinstantiateBlock(self, data, parent, itemType, pos) {\n\t\titemType = itemType ? itemType : 0\n\t\tif (itemType != 0) {\n\t\t\t// console.log(\"道具节点数据\", data, itemType)\n\t\t}\n\t\tlet block = null\n\t\tif (self.blockPool && self.blockPool.size() > 0) {\n\t\t\tblock = self.blockPool.get()\n\t\t} else {\n\t\t\tblock = cc.instantiate(self.blockPrefab)\n\t\t}\n\t\tblock.parent = parent\n\t\tblock.scale = 1\n\t\tblock.x = 0\n\t\tblock.y = 0\n\t\tblock.getComponent('cell').init(self, data, this.blockWidth, itemType, pos)\n\t\treturn block\n\t},\n\t// 回收所有节点\n\trecoveryAllBlocks() {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tlet children = this.blocksContainer.children\n\t\t\tif (children.length != 0) {\n\t\t\t\tlet length = children.length\n\t\t\t\t//   console.log(length)\n\t\t\t\tfor (let i = 0; i < length; i++) {\n\t\t\t\t\tthis.blockPool.put(children[0])\n\t\t\t\t}\n\t\t\t\tfor (let i = 0; i < this.rowNum; i++) {\n\t\t\t\t\tfor (let j = 0; j < this.rowNum; j++) {\n\t\t\t\t\t\tthis.map[i][j] = null\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tresolve('')\n\t\t})\n\t},\n\n});"]}