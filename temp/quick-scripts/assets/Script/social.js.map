{"version":3,"sources":["social.js"],"names":["cc","Class","extends","Component","properties","display","Sprite","groupDisplay","_isShow","isSharing","init","c","self","_controller","wx","showShareMenu","withShareTicket","onShareAppMessage","title","imageUrl","onAudioInterruptionEnd","musicMgr","pauseBg","resumeBg","onShow","options","scene","postMessage","message","shareTicket","openGroupRank","node","active","totalRank","director","resume","onHide","pause","getHighestLevel","onItemShareSuccess","hasShared","game","fakeShareSuccess","highLevel","getStorageSync","getHighestScore","score","onShareButton","shareAppMessage","scoreMgr","levelData","level","name","onUsualShareButton","onItemShareButton","onShakePhone","vibrateShort","onGameOver","highScore","parseInt","highLevelName","gameData","json","setStorageSync","failHighScore","string","kvDataList","Array","push","key","value","setUserCloudStorage","success","fail","res","showRank","closeRank","showGroupRank","closeGroupRank","createImage","sprite","url","image","onload","texture","Texture2D","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","src","update","getComponent","WXSubContextView","onReviveButton","type","adType","audioAd","show","catch","load","then","console","log","err","errMsg","onSkipRevive","onLevelUpButton","createRewardedVideoAd","adUnitId","fakeShare","onError","onClose","isEnded","undefined","showReviveSuccess","askRevive","openBannerAdv","navToMiniprogram","event","custom","navigateToMiniProgram","appId","closeBannerAdv","bannerAd","hide"],"mappings":"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","file":"social.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["/**\n * @author uu\n * @file  排行榜组件\n * @description 用户点击查看排行榜才检查授权,如果此时用户没有授权则进入授权界面\n */\ncc.Class({\n\textends: cc.Component,\n\tproperties: {\n\t\tdisplay: cc.Sprite,\n\t\tgroupDisplay: cc.Sprite,\n\t\t_isShow: false,\n\t\t// score: 0\n\t},\n\tisSharing: false,\n\tinit(c) {\n\t\tlet self = this\n\t\tthis._controller = c\n\t\twx.showShareMenu({\n\t\t\twithShareTicket: true\n\t\t})\n\t\twx.onShareAppMessage(function () {\n\t\t\treturn {\n\t\t\t\ttitle: \"开局只是个农民，现在已经做到宰相\",\n\t\t\t\t// imageUrlId: 'oxEwGvClT0uldQ470pM84w',\n\t\t\t\timageUrl: 'https://mmocgame.qpic.cn/wechatgame/LtJZOjH6Z9ibiaMlpqzldsOf46Q7TZiaysI1fwc4Oj1L3CkbCaJMAMoicibbHu2HUQkOib/0'\n\t\t\t}\n\t\t})\n\t\t// this.display.node.width = window.width\n\t\t//this.display.node.height = window.height\n\t\t//this.display.node.getComponent(cc.WXSubContextView).enabled = false;\n\t\t//   this.tex = new cc.Texture2D();\n\t\t//TODO: 微信小游戏导致音乐自动关闭 处理失败\n\t\t// 监听\n\t\twx.onAudioInterruptionEnd(() => {\n\t\t\tc.musicMgr.pauseBg()\n\t\t\tc.musicMgr.resumeBg()\n\t\t})\n\t\twx.onShow((options) => {\n\t\t\t// console.log(options)\n\t\t\tif (options.scene == 1044) {\n\t\t\t\twx.postMessage({\n\t\t\t\t\tmessage: 'group',\n\t\t\t\t\tshareTicket: options.shareTicket\n\t\t\t\t})\n\t\t\t\tc.openGroupRank()\n\t\t\t\tthis.display.node.active = false\n\t\t\t\tc.totalRank.active = false\n\t\t\t}\n\t\t\tcc.director.resume()\n\t\t\t// if (!self.hasShared && self.isSharing && self._controller.game._status == 1) {\n\t\t\t// \t// TODO 分享成功\n\t\t\t// \tself.onItemShareSuccess()\n\t\t\t// }\n\t\t})\n\t\twx.onHide(() => {\n\t\t\tcc.director.pause()\n\t\t})\n\t\t// 获取最高官阶\n\t\tthis.getHighestLevel()\n\t},\n\tonItemShareSuccess() {\n\t\tthis.hasShared = true\n\t\tthis._controller.game.fakeShareSuccess()\n\t},\n\tgetHighestLevel() {\n\t\tlet highLevel = wx.getStorageSync('highLevel')\n\t\treturn highLevel\n\t},\n\tgetHighestScore() {\n\t\tlet score = wx.getStorageSync('highScore')\n\t\treturn score\n\t},\n\t// --------------- share ----------------\n\tonShareButton() {\n\t\tvar self = this;\n\t\twx.shareAppMessage({\n\t\t\ttitle: \"我终于当上了\" + this._controller.scoreMgr.levelData[this._controller.scoreMgr.level - 1].name + \",不服来战\",\n\t\t\t// imageUrlId: 'oxEwGvClT0uldQ470pM84w',\n\t\t\timageUrl: 'https://mmocgame.qpic.cn/wechatgame/LtJZOjH6Z9ibiaMlpqzldsOf46Q7TZiaysI1fwc4Oj1L3CkbCaJMAMoicibbHu2HUQkOib/0'\n\t\t})\n\t},\n\tonUsualShareButton() {\n\t\twx.shareAppMessage({\n\t\t\ttitle: \"开局只是个农民，现在已经做到宰相\",\n\t\t\t// imageUrlId: 'oxEwGvClT0uldQ470pM84w',\n\t\t\timageUrl: 'https://mmocgame.qpic.cn/wechatgame/LtJZOjH6Z9ibiaMlpqzldsOf46Q7TZiaysI1fwc4Oj1L3CkbCaJMAMoicibbHu2HUQkOib/0'\n\t\t})\n\t},\n\tonItemShareButton() {\n\t\tif (!this.hasShared) {\n\t\t\tthis.isSharing = true\n\t\t} else {\n\t\t\t// 提示玩家 当前局已分享\n\t\t\treturn\n\t\t}\n\t\twx.shareAppMessage({\n\t\t\ttitle: \"开局只是个农民，现在已经做到宰相\",\n\t\t\t// imageUrlId: 'oxEwGvClT0uldQ470pM84w',\n\t\t\timageUrl: 'https://mmocgame.qpic.cn/wechatgame/LtJZOjH6Z9ibiaMlpqzldsOf46Q7TZiaysI1fwc4Oj1L3CkbCaJMAMoicibbHu2HUQkOib/0'\n\t\t})\n\t},\n\tonShakePhone() {\n\t\twx.vibrateShort()\n\t},\n\t// ---------------分数上传---------------\n\tonGameOver(level, score) {\n\t\t//上传分数\n\t\t//打开开放域\n\t\tthis.score = score\n\t\tlet highLevel = level\n\t\tlet highScore = score\n\t\tlet self = this\n\t\thighLevel = wx.getStorageSync('highLevel')\n\t\thighLevel = parseInt(highLevel)\n\t\tif (highLevel) {\n\t\t\thighLevel = highLevel < level ? level : highLevel\n\t\t} else {\n\t\t\thighLevel = level\n\t\t}\n\t\thighScore = wx.getStorageSync('highScore')\n\t\tif (highScore) {\n\t\t\thighScore = parseInt(highScore)\n\t\t\thighScore = highScore < score ? score : highScore\n\t\t} else {\n\t\t\thighScore = score\n\t\t}\n\t\tvar highLevelName = this._controller.gameData.json.levelData[highLevel - 1].name\n\t\twx.setStorageSync('highLevel', highLevel + '')\n\t\twx.setStorageSync('highScore', highScore + '')\n\t\tself._controller.scoreMgr.failHighScore.string = \"您的最高分:\" + (highScore + '')\n\t\tvar kvDataList = new Array()\n\t\tkvDataList.push({\n\t\t\tkey: \"highLevel\",\n\t\t\tvalue: highLevelName,\n\t\t}, {\n\t\t\tkey: \"highScore\",\n\t\t\tvalue: highScore + '',\n\t\t})\n\t\twx.setUserCloudStorage({\n\t\t\t\"KVDataList\": kvDataList,\n\t\t\tsuccess: () => {\n\t\t\t\t//  self.showRank()\n\t\t\t},\n\t\t\tfail: (res) => {\n\t\t\t\t//   console.log(res)\n\t\t\t}\n\t\t})\n\t},\n\tshowRank() {\n\t\twx.postMessage({\n\t\t\tmessage: 'Show'\n\t\t})\n\t\tthis.display.node.active = true\n\t\tthis._isShow = true\n\t},\n\t// switchRankType() {\n\t//   wx.postMessage({\n\t//     message: 'switchRank'\n\t//   })\n\t//   this._isShow = true\n\t// },\n\tcloseRank() {\n\t\tthis.display.node.active = false\n\t\twx.postMessage({\n\t\t\tmessage: 'Hide'\n\t\t})\n\t\tthis._isShow = false\n\t},\n\tshowGroupRank() {\n\t\twx.postMessage({\n\t\t\tmessage: 'Show'\n\t\t})\n\t\tthis.groupDisplay.node.active = true\n\t\tthis._isShow = true\n\t},\n\t// switchRankType() {\n\t//   wx.postMessage({\n\t//     message: 'switchRank'\n\t//   })\n\t//   this._isShow = true\n\t// },\n\tcloseGroupRank() {\n\t\tthis.groupDisplay.node.active = false\n\t\twx.postMessage({\n\t\t\tmessage: 'Hide'\n\t\t})\n\t\tthis._isShow = false\n\t},\n\tcreateImage(sprite, url) {\n\t\tlet image = wx.createImage();\n\t\timage.onload = function () {\n\t\t\tlet texture = new cc.Texture2D();\n\t\t\ttexture.initWithElement(image);\n\t\t\ttexture.handleLoadedTexture();\n\t\t\tsprite.spriteFrame = new cc.SpriteFrame(texture);\n\t\t};\n\t\timage.src = url;\n\t},\n\tupdate() {\n\t\tif (this._isShow) {\n\t\t\tif (this.display.node.active) {\n\t\t\t\tthis.display.node.getComponent(cc.WXSubContextView).update()\n\t\t\t}\n\t\t\tif (this.groupDisplay.node.active) {\n\t\t\t\tthis.groupDisplay.node.getComponent(cc.WXSubContextView).update()\n\t\t\t}\n\t\t}\n\t},\n\t// 控制打开广告\n\tonReviveButton(type) {\n\t\t// 广告位\n\t\tlet self = this\n\t\tthis.adType = type //0表示加倍 1表示复活 2表示炸弹\n\t\tif (this.audioAd) {\n\t\t\tthis.audioAd.show().catch(() => {\n\t\t\t\t// 失败重试\n\t\t\t\tthis.audioAd.load()\n\t\t\t\t\t.then(() => this.audioAd.show())\n\t\t\t\t\t.catch(err => {\n\t\t\t\t\t\tconsole.log('激励视频 广告显示失败', err.errMsg)\n\t\t\t\t\t\tif (self.adType == 1) {\n\t\t\t\t\t\t\tself._controller.game.onSkipRevive()\n\t\t\t\t\t\t} else if (self.adType == 2) {\n\t\t\t\t\t\t\tself._controller.scoreMgr.onLevelUpButton()\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tself.onItemShareSuccess()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t})\n\t\t\treturn\n\t\t}\n\t\tthis.audioAd = wx.createRewardedVideoAd({\n\t\t\tadUnitId: 'adunit-7a9758fd45a5f9ce'\n\t\t})\n\t\tthis.audioAd.show().catch(() => {\n\t\t\t// 失败重试\n\t\t\tthis.audioAd.load()\n\t\t\t\t.then(() => this.audioAd.show())\n\t\t\t\t.catch(err => {\n\t\t\t\t\tself.fakeShare()\n\t\t\t\t})\n\t\t})\n\t\tthis.audioAd.onError(err => {\n\t\t\tself.fakeShare()\n\t\t})\n\t\tthis.audioAd.onClose((res) => {\n\t\t\tif (self.adType == 1) {\n\t\t\t\tif (res && res.isEnded || res === undefined) {\n\t\t\t\t\tself._controller.game.showReviveSuccess()\n\t\t\t\t} else {\n\t\t\t\t\tself._controller.game.askRevive()\n\t\t\t\t}\n\t\t\t} else if (self.adType == 0) {\n\t\t\t\tif (res && res.isEnded || res === undefined) {\n\t\t\t\t\tself._controller.scoreMgr.onLevelUpButton(2)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (res && res.isEnded || res === undefined) {\n\t\t\t\t\tself.onItemShareSuccess()\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n\tfakeShare() {\n\t\tlet self = this\n\t\twx.shareAppMessage({\n\t\t\ttitle: \"我已经玩到\" + this._controller.scoreMgr.score + \"分了，邀请你来挑战\",\n\t\t\t// imageUrlId: 'oxEwGvClT0uldQ470pM84w',\n\t\t\timageUrl: 'https://mmocgame.qpic.cn/wechatgame/LtJZOjH6Z9ibiaMlpqzldsOf46Q7TZiaysI1fwc4Oj1L3CkbCaJMAMoicibbHu2HUQkOib/0'\n\t\t})\n\t\tif (this.adType) {\n\t\t\tself._controller.game.showReviveSuccess()\n\t\t} else {\n\t\t\tself._controller.scoreMgr.onLevelUpButton(2)\n\t\t}\n\t},\n\topenBannerAdv() {\n\t\t// 创建 Banner 广告实例，提前初始化\n\t\t// let screenWidth = wx.getSystemInfoSync().screenWidth\n\t\t// let bannerHeight = screenWidth / 350 * 120\n\t\t// let screenHeight = wx.getSystemInfoSync().screenHeight - 108\n\t\t// let adUnitIds = [\n\t\t//   'adunit-510a4ec39065ef96',\n\t\t//   'adunit-29b0fa7a2db8e8cb',\n\t\t//   'adunit-4020bb9ea439e6a5'\n\t\t// ]\n\t\t// if (this.bannerAd) {\n\t\t//   this.bannerAd.destroy()\n\t\t// }\n\t\t// this.bannerAd = wx.createBannerAd({\n\t\t//   adUnitId: adUnitIds[Math.floor(Math.random() * 3)],\n\t\t//   style: {\n\t\t//     left: 0,\n\t\t//     top: screenHeight,\n\t\t//     width: 620,\n\t\t//   }\n\t\t// })\n\t\t// // 在适合的场景显示 Banner 广告\n\t\t// this.bannerAd.onLoad(() => {\n\t\t//   // console.log('banner 广告加载成功')\n\t\t// })\n\t\t// this.bannerAd.onError((e) => {\n\t\t//   console.log('banner 广告加载失败', e)\n\t\t// })\n\t\t// this.bannerAd.show()\n\t\t//   .then()\n\t},\n\tnavToMiniprogram(event, custom) {\n\t\tconsole.log(custom)\n\t\twx.navigateToMiniProgram({\n\t\t\tappId: custom\n\t\t})\n\t},\n\tcloseBannerAdv() {\n\t\tif (this.bannerAd) {\n\t\t\tthis.bannerAd.hide()\n\t\t}\n\t}\n});"]}