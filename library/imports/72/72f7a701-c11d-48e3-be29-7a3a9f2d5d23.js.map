{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\score.js"],"names":["AC","require","cc","Class","extends","Component","properties","scorePrefab","Prefab","scoreParticlePrefab","mainScoreLabel","Label","successDialog","characterMgr","failDialog","Node","multPropPrefab","chainSpriteFrameArr","SpriteFrame","stepAniLabel","tipBox","init","g","_game","_controller","score","leftStep","config","json","originStep","chain","level","reviveTime","closeMultLabel","levelData","gameData","nameLabel","string","progressBar","leftStepLabel","node","runAction","hide","scoreTimer","currentAddedScore","active","showCharacter","hideChainSprite","social","height","getHighestLevel","onStep","giftStep","start","generatePool","bindNode","scorePool","NodePool","i","instantiate","put","scoreParticlePool","scoreParticle","multPropPool","multProp","instantiateScore","self","num","pos","size","get","parent","scoreContainer","getComponent","scoreParticleTime","getChildByName","multLabel","chainSprite","Sprite","failScore","failName","failSprite","failHighScore","Promise","resolve","reject","onGameOver","showStepAni","addScore","scoreBase","chainTimer","clearTimeout","initCurrentScoreLabel","setTimeout","onCurrentScoreLabel","x","y","callFunc","multiple","checkLevelUp","checkChain","checkChainTimer","chainConfig","length","max","min","showChainSprite","id","spriteFrame","scale","popOut","levelLimit","onLevelUp","addMult","color","maxMultiple","showMultLabel","callback","action","spawn","moveTo","scaleTo","easing","easeBackOut","seq","sequence","pageMgr","addPage","musicMgr","onWin","onSuccessDialog","_status","openBannerAdv","hideNextLevelData","onLevelUpButton","double","console","log","isLevelUp","currentTarget","onOpenPage","step","onLevelUpBtn","name","then","showNextLevelData","toggleVisibility","moveBy","isTrue","gameOver","updateFailPage","askRevive","onDoubleStepBtn","sys","platform","WECHAT_GAME","onReviveButton","onDoubleStep","onRevive","nextLevelData","onFail"],"mappings":"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","file":"score.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["/**\n * @author uu\n * @file  UI 分数控制器\n */\nvar AC = require('action')\n\ncc.Class({\n  extends: cc.Component,\n  properties: {\n    scorePrefab: cc.Prefab,\n    scoreParticlePrefab: cc.Prefab,\n    mainScoreLabel: cc.Label,\n    successDialog: require('successDialog'),\n    characterMgr: require('character'),\n    failDialog: cc.Node,\n    multPropPrefab: cc.Prefab,\n    // progressBar: require('progress'),\n    // leftStepLabel: cc.Label,\n    chainSpriteFrameArr: [cc.SpriteFrame],\n    stepAniLabel: cc.Label,\n\n    //提示小框\n    tipBox: require('tipBox')\n  },\n  init(g) {\n    this._game = g\n    this._controller = g._controller\n    this.score = 0\n    this.leftStep = this._controller.config.json.originStep\n    this.chain = 1\n    this.level = 1\n    this.reviveTime = 0\n    this.closeMultLabel()\n    this.levelData = g._controller.gameData.json.levelData\n    this.nameLabel.string = \"农民\"\n    this.progressBar.init(0, this.levelData[this.level - 1], this.level)\n    this.leftStepLabel.string = this.leftStep\n    this.stepAniLabel.node.runAction(cc.hide())\n    this.scoreTimer = []\n    this.currentAddedScore = 0\n    this.mainScoreLabel.node.active = false\n    this.characterMgr.showCharacter(this.level)\n    this.hideChainSprite()\n\n    this.tipBox.init(this, 0)\n    if (this._controller.social.node.active) {\n      let height = this._controller.social.getHighestLevel()\n      if (height) {\n        this.onStep(this.levelData[+height - 1].giftStep)\n      }\n    }\n  },\n  start() {\n    this.generatePool()\n    this.bindNode()\n  },\n  generatePool() {\n    this.scorePool = new cc.NodePool()\n    for (let i = 0; i < 20; i++) {\n      let score = cc.instantiate(this.scorePrefab)\n      this.scorePool.put(score)\n    }\n    this.scoreParticlePool = new cc.NodePool()\n    for (let i = 0; i < 20; i++) {\n      let scoreParticle = cc.instantiate(this.scoreParticlePrefab)\n      this.scoreParticlePool.put(scoreParticle)\n    }\n    this.multPropPool = new cc.NodePool()\n    for (let i = 0; i < 3; i++) {\n      let multProp = cc.instantiate(this.multPropPrefab)\n      this.multPropPool.put(multProp)\n    }\n  },\n  // 实例化单个方块\n  instantiateScore(self, num, pos) {\n    let score = null\n    if (self.scorePool && self.scorePool.size() > 0) {\n      score = self.scorePool.get()\n    } else {\n      score = cc.instantiate(self.scorePrefab)\n    }\n    score.parent = this.scoreContainer\n    score.getComponent('scoreCell').init(self, num, pos)\n\n    let scoreParticle = null\n    if (self.scoreParticlePool && self.scoreParticlePool.size() > 0) {\n      scoreParticle = self.scoreParticlePool.get()\n    } else {\n      scoreParticle = cc.instantiate(self.scoreParticlePrefab)\n    }\n    scoreParticle.parent = this.scoreContainer\n    scoreParticle.getComponent('scoreParticle').init(self, pos, this._controller.config.json.scoreParticleTime)\n  },\n  bindNode() {\n    this.leftStepLabel = this.node.getChildByName('UI').getChildByName('leftStepNode').getChildByName('Label').getComponent(cc.Label)\n    this.progressBar = this.node.getChildByName('UI').getChildByName('scoreNode').getChildByName('progressBar').getComponent('progress')\n    this.scoreContainer = this.node.getChildByName('UI').getChildByName('scoreGroup')\n    this.multLabel = this.mainScoreLabel.node.getChildByName('mult').getComponent(cc.Label)\n    this.nameLabel = this.node.getChildByName('UI').getChildByName('scoreNode').getChildByName('progressBar').getChildByName('name').getComponent(cc.Label)\n    // 失败时更新失败UI\n    this.chainSprite = this.node.getChildByName('UI').getChildByName('chainSprite').getComponent(cc.Sprite)\n    this.failScore = this.failDialog.getChildByName('info').getChildByName('score').getComponent(cc.Label)\n    this.failName = this.failDialog.getChildByName('info').getChildByName('level').getComponent(cc.Label)\n    this.failSprite = this.failDialog.getChildByName('info').getChildByName('sprite').getComponent(cc.Sprite)\n    this.failHighScore = this.failDialog.getChildByName('info').getChildByName('highScore').getComponent(cc.Label)\n  },\n  //--------------------- 分数控制 ---------------------\n  // 增加 减少步数并且刷新UI\n  onStep(num) {\n    this.leftStep += num\n    return new Promise((resolve, reject) => {\n      if (this.leftStep < 0) {\n        this.leftStep = 0\n        this.onGameOver()\n        resolve(false)\n      } else {\n        resolve(true)\n      }\n      this.leftStepLabel.string = this.leftStep\n      if (num > 0) {\n        this.showStepAni(num)\n      }\n    })\n  },\n\n  //增加分数总控制 获取连击\n  addScore(pos, score) {\n    score = score || this._controller.config.json.scoreBase\n    // 一次消除可以叠chain\n    if (this.chainTimer) {\n      clearTimeout(this.chainTimer)\n    }\n    this.initCurrentScoreLabel()\n    this.chainTimer = setTimeout(() => {\n        this.onCurrentScoreLabel(this.currentAddedScore, {\n          x: -60,\n          y: 355\n        }, cc.callFunc(() => {\n          this.score += this.currentAddedScore * this.multiple\n          this.checkLevelUp()\n          this.chain = 1\n          this.closeMultLabel()\n          this.hideChainSprite()\n          this.currentAddedScore = 0\n          this.mainScoreLabel.node.active = false\n        }, this))\n      }, 500 / 1\n      // (cc.game.getFrameRate() / 60)\n    )\n    let addScore = score == this._controller.config.json.scoreBase ? (score + (this.chain > 16 ? 16 : (this.chain - 1)) * 10) : score\n    // let addScore = score == 10 ? score * (this.chain > 10 ? 10 : this.chain) : score\n    this.currentAddedScore += addScore\n    this.mainScoreLabel.string = this.currentAddedScore\n    this.instantiateScore(this, addScore, pos)\n    this.chain++\n    this.checkChain()\n  },\n  // 判断连击\n  checkChain() {\n    if (this.checkChainTimer) {\n      clearTimeout(this.checkChainTimer)\n    }\n    this.checkChainTimer = setTimeout(() => {\n      let config = this._controller.config.json.chainConfig\n      for (let i = 0; i < config.length; i++) {\n        if (this.chain <= config[i].max && this.chain >= config[i].min) {\n          //  console.log(config[i].text)\n          this.showChainSprite(i)\n          return\n        }\n      }\n    }, 200)\n  },\n  showChainSprite(id) {\n    this.chainSprite.spriteFrame = this.chainSpriteFrameArr[id]\n    this.chainSprite.node.scale = 0.5\n    this.chainSprite.node.active = true\n    this.chainSprite.node.runAction(AC.popOut(0.3))\n  },\n  hideChainSprite() {\n    this.chainSprite.node.active = false\n  },\n  checkLevelUp() {\n    if (this.level < this.levelData.length && this.score >= this.levelData[this.level - 1].score) {\n      this.level++\n      this.level > (this.levelData.length + 1) ? this.levelLimit() : this.onLevelUp()\n    }\n    this.progressBar.init(this.score, this.levelData[this.level - 1], this.level)\n  },\n  // 增加倍数\n  addMult(color, pos) {\n    //TODO: 动态生成一个图片 移动到multLabel上 有bug\n    // if (this.multPropPool.size() > 0) {\n    //   let multProp = this.multPropPool.get()\n    //   multProp.parent = this.mainScoreLabel.node\n    //   multProp.x = pos.x\n    //   multProp.y = pos.y\n    //   multProp.getComponent(cc.Sprite).spriteFrame = this._game.propSpriteFrame[color - 1]\n    //   multProp.runAction(cc.sequence(cc.moveTo(0.2, 187, 0), cc.callFunc(() => {\n    //     this.multPropPool.put(multProp)\n    //   })))\n    // }\n    if (this.multiple < this._controller.config.json.maxMultiple) {\n      this.multiple *= 2\n      this.showMultLabel()\n    }\n  },\n  // 关闭倍数的数字显示\n  closeMultLabel() {\n    this.multiple = 1\n    this.multLabel.node.active = false\n  },\n  showMultLabel() {\n    this.multLabel.node.scale = 0.5\n    this.multLabel.string = this.multiple\n    this.multLabel.node.active = true\n    this.multLabel.node.runAction(AC.popOut(0.3))\n  },\n  // 增加分数倍数\n  initCurrentScoreLabel() {\n    this.mainScoreLabel.node.active = true\n    this.mainScoreLabel.node.x = 0\n    this.mainScoreLabel.node.y = 0\n    this.mainScoreLabel.node.scale = 1\n  },\n  // 生成小的分数节点\n  onCurrentScoreLabel(num, pos, callback) {\n    // TODO: 增加一个撒花特效\n    this.mainScoreLabel.string = num\n    let action = cc.spawn(cc.moveTo(0.2, pos.x, pos.y), cc.scaleTo(0.2, 0.4)).easing(cc.easeBackOut())\n    let seq = cc.sequence(action, callback)\n    this.mainScoreLabel.node.runAction(seq)\n  },\n  // 升级\n  onLevelUp() {\n    this._controller.pageMgr.addPage(2)\n    this._controller.pageMgr.addPage(3)\n    this._controller.musicMgr.onWin()\n    this.successDialog.init(this, this.level, this.levelData, this.score) //升级之后的等级\n    this.characterMgr.onLevelUp()\n    this.characterMgr.onSuccessDialog(this.level)\n    this._game._status = 2\n    if (this._controller.social.node.active) {\n      this._controller.social.openBannerAdv()\n    }\n  },\n  // 等级限制\n  levelLimit() {\n    //console.log('等级达到上限')\n    this.hideNextLevelData()\n  },\n  // 点击升级按钮\n  onLevelUpButton(double) {\n    console.log(double)\n    if (this.isLevelUp) {\n      return\n    } else {\n      this.isLevelUp = true\n    }\n    setTimeout(() => {\n      this.isLevelUp = false\n    }, 500)\n    if (double && double.currentTarget) {\n      double = 1\n    } else {\n      double = double || 1\n    }\n    this._controller.pageMgr.onOpenPage(1)\n    this.initCurrentScoreLabel()\n    this.mainScoreLabel.string = this.levelData[this.level - 2].step * double\n    this.characterMgr.onLevelUpBtn(this.level)\n    this.nameLabel.string = this.levelData[this.level - 1].name\n    setTimeout(() => {\n      this.onCurrentScoreLabel(this.levelData[this.level - 2].step * double, {\n        x: -248,\n        y: 350\n      }, cc.callFunc(() => {\n        // this.tipBox.init(this) 每次升级就咏诗\n        this.onStep(this.levelData[this.level - 2].step * double).then()\n        this._game._status = 1\n        this.mainScoreLabel.node.active = false\n      }))\n    }, 300);\n    this.showNextLevelData()\n    this.checkLevelUp()\n  },\n  // todo: 新增一个 动画 数字上浮和缩放\n  showStepAni(num) {\n    this.stepAniLabel.string = '+' + (num + '')\n    this.stepAniLabel.node.x = -248\n    this.stepAniLabel.node.y = 400\n    this.stepAniLabel.node.runAction(cc.sequence(cc.toggleVisibility(), cc.moveBy(0.6, 0, 60), cc.toggleVisibility()))\n    let action = cc.sequence(cc.scaleTo(0.2, 0.8), AC.popOut(0.8))\n    this.leftStepLabel.node.parent.runAction(action)\n  },\n  // 游戏结束\n  // todo 复活\n  onGameOver(isTrue) {\n    isTrue = isTrue || 0\n    if (this._game._status != 3 && (isTrue || this.reviveTime >= 3)) {\n      this._game.gameOver()\n      this.updateFailPage()\n      if (this._controller.social.node.active) {\n        // 仅上传分数\n        this._controller.social.onGameOver(this.level, this.score)\n      }\n    } else if (!isTrue) {\n      this._game.askRevive()\n    }\n  },\n  onDoubleStepBtn() {\n    if (cc.sys.platform === cc.sys.WECHAT_GAME) {\n      this._controller.social.onReviveButton(0)\n    } else {\n      this.onLevelUpButton(2)\n    }\n  },\n  onDoubleStep() {\n    this.onLevelUpButton(2)\n  },\n  onRevive() {\n    this.reviveTime += 1\n    this.onStep(5).then()\n  },\n  // 展示下一级的信息\n  showNextLevelData() {\n    let nextLevelData = this.levelData[this.level]\n  },\n  // 达到最高级之后 隐藏\n  hideNextLevelData() {\n\n  },\n  updateFailPage() {\n    this.failScore.string = \" \" + (this.score + '')\n    this.characterMgr.onFail(this.level)\n    this.failName.string = this.levelData[this.level - 1].name\n    //this.failHighScore.string = \"正在获取您的最高分...\"\n  },\n\n});"]}