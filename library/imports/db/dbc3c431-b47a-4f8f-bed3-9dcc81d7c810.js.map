{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\cell.js"],"names":["cc","Class","extends","Component","properties","_status","_itemType","warningSprite","Sprite","lightSprite","init","g","data","width","itemType","pos","_game","x","y","warningType","isPush","bindEvent","color","Math","ceil","random","colorSprite","node","getChildByName","getComponent","spriteFrame","propSpriteFrame","blockSprite","_width","_controller","active","height","startTime","iid","jid","gap","rotation","playStartAction","changeItemType","type","onWarning","warningSpriteFrame","action1","blink","warningInit","growInit","growType","grow","on","Node","EventType","TOUCH_START","onTouched","isChain","isBomb","time","setTimeout","JSON","stringify","self","playDieAction","then","onBlockPop","isSingle","scale","_score","tipBox","scaleTo","action2","easing","easeBackOut","action","sequence","runAction","onUserTouched","onStep","res","checkNeedFall","musicMgr","onPlayAudio","onItem","addScore","v2","config","json","propConfig","score","map","rowNum","playFallAction","moveBy","blockWidth","easeBounceOut","seq","callFunc","scaleX","scaleY","animationSpeed","clearTimeout","surfaceTimer","stopAllActions","Promise","resolve","reject","moveTo","target","action3","spawn","surfaceAction","dela","generatePropAction","generateItem"],"mappings":"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","file":"cell.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["/**\n * @author uu\n * @file 单个方块控制\n */\ncc.Class({\n  extends: cc.Component,\n  properties: {\n    _status: 0, //1为可触发点击 2为已经消失\n    _itemType: 0, //新增道具功能 1为双倍倍数 2为炸弹\n    warningSprite: cc.Sprite,\n    lightSprite: cc.Sprite,\n  },\n  init(g, data, width, itemType, pos) {\n    this._game = g\n    this._status = 1\n    if (pos) {\n      //cc.log('生成的方块', pos)\n    }\n    pos = pos || {\n      x: data.x,\n      y: data.y\n    }\n    this._itemType = itemType || 0\n    this.warningType = 0\n    this.isPush = false\n    this.bindEvent()\n    this.color = data.color || Math.ceil(Math.random() * 4)\n    this.colorSprite = this.node.getChildByName('color').getComponent(cc.Sprite)\n    this.colorSprite.spriteFrame = itemType ? g.propSpriteFrame[(itemType - 1) * 4 + this.color - 1] : this._game.blockSprite[this.color - 1]\n    this.warningSprite.spriteFrame = ''\n    this._width = width\n    this._controller = g._controller\n    // 计算宽\n    this.lightSprite.node.active = false\n    //  this.lightSprite.spriteFrame = this._game.blockSprite[this.color - 1]\n    this.node.width = this.node.height = width\n    this.startTime = data.startTime\n    this.iid = data.y\n    this.jid = data.x\n    // console.log('生成方块位置', data.y, data.x)\n    this.node.x = -(730 / 2 - g.gap - width / 2) + pos.x * (width + g.gap)\n    this.node.y = (730 / 2 - g.gap - width / 2) - pos.y * (width + g.gap)\n    this.node.rotation = 0\n    this.playStartAction()\n\t},\n\tchangeItemType(type){\n\t\tthis._itemType=type\n\t\tthis.colorSprite.spriteFrame = type ? this._game.propSpriteFrame[(type - 1) * 4 + this.color - 1] : this._game.blockSprite[this.color - 1]\n\t},\n  onWarning(type) {\n    this.warningSprite.spriteFrame = this._game.warningSpriteFrame[type - 1] || ''\n    this.warningType = type\n    //   this.lightSprite.node.active = true\n    let action1 = cc.blink(1, 10)\n    //   this.lightSprite.node.runAction(action1)\n  },\n  warningInit() {\n    this.warningSprite.spriteFrame = ''\n    //  this.lightSprite.node.active = false\n    this.isPush = false\n  },\n  growInit() {\n    this.growType = 0\n    this.colorSprite.node.height = this.colorSprite.node.width = this._width\n    this.colorSprite.node.y = this.colorSprite.node.x = 0\n  },\n  grow(type) { //1234 上下左右\n    switch (type) {\n      case 1:\n        if (this.growType != 2) {\n          this.colorSprite.node.height += this._game.gap * 2\n          this.colorSprite.node.y += this._game.gap\n          this.growType = 1\n        }\n        break\n      case 2:\n        if (this.growType != 2) {\n          this.colorSprite.node.height += this._game.gap * 2\n          this.colorSprite.node.y -= this._game.gap\n          this.growType = 1\n        }\n        break\n      case 3:\n        if (this.growType != 1) {\n          this.colorSprite.node.width += this._game.gap * 2\n          this.colorSprite.node.x -= this._game.gap\n          this.growType = 2\n        }\n        break\n      case 4:\n        if (this.growType != 1) {\n          this.colorSprite.node.width += this._game.gap * 2\n          this.colorSprite.node.x += this._game.gap\n          this.growType = 2\n        }\n        break\n    }\n  },\n  bindEvent() {\n    this.node.on(cc.Node.EventType.TOUCH_START, this.onTouched, this)\n\n  },\n  // 用户点击 或者被其他方块触发\n  onTouched(color, isChain, isBomb, time) { //道具新增参数 isChain是否连锁 isBomb是否强制消除\n    if (time) {\n      setTimeout(() => {\n        this.onTouched(color, false, isBomb)\n      }, time)\n      return\n    }\n    isChain = JSON.stringify(isChain) == 'null' ? true : isChain\n    isBomb = isBomb ? isBomb : false\n    color=color||this.color\n    let self = this\n    // 爆炸触发\n    if (this._status == 1 && isBomb == true) {\n      this._status = 2\n      this.playDieAction().then(() => {\n        this.onBlockPop(color, isChain, isBomb)\n      })\n      return\n    }\n\n    if (color.type) {\n      // 一定是用户主动触发 保存这个坐标给game\n      if (this.isSingle && this._itemType <= 1) {\n        this.node.scale = 1\n        this._game._score.tipBox.init(this._game._score, 3)\n        let action1 = cc.scaleTo(0.1, 1.1, 0.9)\n        let action2 = cc.scaleTo(0.3, 1).easing(cc.easeBackOut(2.0))\n        let action = cc.sequence(action1, action2)\n        this.node.runAction(action)\n        return\n      }\n      // console.log('方块位置', this.iid, this.jid, this._itemType)\n      color = this.color\n      if (this._status == 1 && this._game._status == 1 && this.color == color) {\n        this._game.onUserTouched(this.iid, this.jid, this._itemType, this.color, this.warningType, {\n          x: this.node.x,\n          y: this.node.y\n        })\n        this._game._score.onStep(-1).then((res) => {\n          if (res) {\n            this.playDieAction().then(() => {\n              this.onBlockPop(color, null, null)\n            })\n          }\n        })\n      }\n    } else {\n      // 由其他方块触发\n      if (this._status == 1 && this._game._status == 5 && this.color == color) {\n        this.playDieAction().then(() => {\n          this.onBlockPop(color, null, null)\n        })\n      }\n    }\n  },\n  onBlockPop(color, isChain, isBomb) {\n    let self = this\n    isChain = JSON.stringify(isChain) == 'null' ? true : isChain\n    isBomb = isBomb ? isBomb : false\n    self._game.checkNeedFall()\n    self._game._status = 5\n    self._controller.musicMgr.onPlayAudio(0\n      //self._game._score.chain - 1\n    )\n    if (this._itemType != 0) {\n      // console.log(\"触发了道具\", this._itemType)\n\n      self._game.onItem(this._itemType, this.color, {\n        x: this.node.x,\n        y: this.node.y\n      })\n    }\n    self._game._score.addScore(cc.v2(this.node.x, this.node.y - this.node.width + this._game.gap), this._itemType == 3 ? this._game._controller.config.json.propConfig[2].score : null)\n\n    // 连锁状态\n    if (isChain) {\n      if ((self.iid - 1) >= 0) {\n        self._game.map[self.iid - 1][self.jid].getComponent('cell').onTouched(color)\n      }\n      if ((self.iid + 1) < this._game.rowNum) {\n        self._game.map[self.iid + 1][self.jid].getComponent('cell').onTouched(color)\n      }\n      if ((self.jid - 1) >= 0) {\n        self._game.map[self.iid][self.jid - 1].getComponent('cell').onTouched(color)\n      }\n      if ((self.jid + 1) < this._game.rowNum) {\n        self._game.map[self.iid][self.jid + 1].getComponent('cell').onTouched(color)\n      }\n    }\n  },\n  playFallAction(y, data) { //下降了几个格子\n    this._status = 0\n    if (data) {\n      this.iid = data.y\n      this.jid = data.x\n    }\n    let action = cc.moveBy(0.25, 0, -y * (this._game.gap + this._game.blockWidth)).easing(cc.easeBounceOut(5 / y)) //1 * y / this._game.animationSpeed\n    let seq = cc.sequence(action, cc.callFunc(() => {\n      this._status = 1\n      //  this._game.checkNeedGenerator()\n    }, this))\n    this.node.runAction(seq)\n  },\n  playStartAction() {\n    this.node.scaleX = 0\n    this.node.scaleY = 0\n    let action = cc.scaleTo(0.8 / this._game.animationSpeed, 1, 1).easing(cc.easeBackOut())\n    let seq = cc.sequence(action, cc.callFunc(() => {\n      this._status = 1\n    }, this))\n    // 如果有延迟时间就用延迟时间\n    if (this.startTime) {\n      setTimeout(() => {\n          this.node.runAction(seq)\n        }, this.startTime / 1\n        // (cc.game.getFrameRate() / 60)\n      )\n    } else {\n      this.node.runAction(seq)\n    }\n  },\n  playDieAction() {\n    let self = this\n    clearTimeout(this.surfaceTimer)\n    this.node.stopAllActions()\n    this._status = 2\n    this.node.scaleX = 1\n    this.node.scaleY = 1\n    return new Promise((resolve, reject) => {\n      let action\n      if (this.warningSprite.spriteFrame) { //有道具预警\n        let action1 = cc.scaleTo(0.2 / self._game.animationSpeed, 1.1)\n        let action2 = cc.moveTo(0.2 / self._game.animationSpeed, this._game.target.x, this._game.target.y)\n        let action3 = cc.scaleTo(0.2, 0)\n        var seq = cc.sequence(action1, cc.callFunc(() => {\n          resolve('')\n        }, this), cc.spawn(action2, action3))\n      } else {\n        action = cc.scaleTo(0.2 / self._game.animationSpeed, 0, 0)\n        var seq = cc.sequence(action, cc.callFunc(() => {\n          resolve('')\n        }, this))\n      }\n      self.node.runAction(seq)\n    });\n  },\n  surfaceAction(dela) {\n    this.surfaceTimer = setTimeout(() => {\n      let action = cc.scaleTo(0.4 / this._game.animationSpeed, 0.8, 0.8)\n      let action1 = cc.scaleTo(0.4 / this._game.animationSpeed, 1, 1)\n      this.node.runAction(cc.sequence(action, action1))\n    }, dela)\n  },\n  generatePropAction() {\n\n  },\n  generateItem(type) {\n    this._itemType = type\n  },\n});"]}